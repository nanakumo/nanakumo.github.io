<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>如何用统计软件进行简单的回归分析</title>
    <url>/2023/05/02/%E5%A6%82%E4%BD%95%E7%94%A8%E7%BB%9F%E8%AE%A1%E8%BD%AF%E4%BB%B6%E8%BF%9B%E8%A1%8C%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p>是极其潦草的学习笔记 w</p>
<p><span id="more"></span></p>
<h1 id="python篇"><a class="anchor" href="#python篇">#</a> Python 篇</h1>
<h2 id="package的准备"><a class="anchor" href="#package的准备">#</a> package 的准备</h2>
<ol>
<li>pandas</li>
<li>statsmodels</li>
<li>openpyxl</li>
</ol>
<h2 id="读取文件"><a class="anchor" href="#读取文件">#</a> 读取文件</h2>
<ol>
<li>要指定好文件的路径</li>
<li>最好使用 <code>names=['x','y']</code>  来指定<strong>说明变量</strong>和<strong>目标变量</strong>。</li>
</ol>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>file_pass <span class="token operator">=</span> <span class="token string">r"D:\python\data.xlsx"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>file_pass<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'cost'</span><span class="token punctuation">,</span> <span class="token string">'sales'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> statsmodels<span class="token punctuation">.</span>formula<span class="token punctuation">.</span>api <span class="token keyword">as</span> smf</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>model <span class="token operator">=</span> smf<span class="token punctuation">.</span>ols<span class="token punctuation">(</span><span class="token string">'sales ~ cost'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>df<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>result <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>输出结果为：</strong></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>OLS Regression Results                            </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Dep<span class="token punctuation">.</span> Variable<span class="token punctuation">:</span>                  sales   R<span class="token operator">-</span>squared<span class="token punctuation">:</span>                       <span class="token number">1.000</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Model<span class="token punctuation">:</span>                            OLS   Adj<span class="token punctuation">.</span> R<span class="token operator">-</span>squared<span class="token punctuation">:</span>                  <span class="token number">1.000</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Method<span class="token punctuation">:</span>                 Least Squares   F<span class="token operator">-</span>statistic<span class="token punctuation">:</span>                 <span class="token number">1.981e+31</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Date<span class="token punctuation">:</span>                Tue<span class="token punctuation">,</span> <span class="token number">02</span> May <span class="token number">2023</span>   Prob <span class="token punctuation">(</span>F<span class="token operator">-</span>statistic<span class="token punctuation">)</span><span class="token punctuation">:</span>           <span class="token number">2.50e-47</span></pre></td></tr><tr><td data-num="7"></td><td><pre>Time<span class="token punctuation">:</span>                        <span class="token number">14</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">:</span><span class="token number">47</span>   Log<span class="token operator">-</span>Likelihood<span class="token punctuation">:</span>                 <span class="token number">153.61</span></pre></td></tr><tr><td data-num="8"></td><td><pre>No<span class="token punctuation">.</span> Observations<span class="token punctuation">:</span>                   <span class="token number">5</span>   AIC<span class="token punctuation">:</span>                            <span class="token operator">-</span><span class="token number">303.2</span></pre></td></tr><tr><td data-num="9"></td><td><pre>Df Residuals<span class="token punctuation">:</span>                       <span class="token number">3</span>   BIC<span class="token punctuation">:</span>                            <span class="token operator">-</span><span class="token number">304.0</span></pre></td></tr><tr><td data-num="10"></td><td><pre>Df Model<span class="token punctuation">:</span>                           <span class="token number">1</span>                                         </pre></td></tr><tr><td data-num="11"></td><td><pre>Covariance Type<span class="token punctuation">:</span>            nonrobust                                         </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                 coef    std err          t      P<span class="token operator">></span><span class="token operator">|</span>t<span class="token operator">|</span>      <span class="token punctuation">[</span><span class="token number">0.025</span>      <span class="token number">0.975</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span></pre></td></tr><tr><td data-num="15"></td><td><pre>Intercept     <span class="token number">10.0000</span>   <span class="token number">1.49e-14</span>   <span class="token number">6.71e+14</span>      <span class="token number">0.000</span>      <span class="token number">10.000</span>      <span class="token number">10.000</span></pre></td></tr><tr><td data-num="16"></td><td><pre>cost           <span class="token number">2.0000</span>   <span class="token number">4.49e-16</span>   <span class="token number">4.45e+15</span>      <span class="token number">0.000</span>       <span class="token number">2.000</span>       <span class="token number">2.000</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></pre></td></tr><tr><td data-num="18"></td><td><pre>Omnibus<span class="token punctuation">:</span>                          nan   Durbin<span class="token operator">-</span>Watson<span class="token punctuation">:</span>                   <span class="token number">0.667</span></pre></td></tr><tr><td data-num="19"></td><td><pre>Prob<span class="token punctuation">(</span>Omnibus<span class="token punctuation">)</span><span class="token punctuation">:</span>                    nan   Jarque<span class="token operator">-</span>Bera <span class="token punctuation">(</span>JB<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token number">0.375</span></pre></td></tr><tr><td data-num="20"></td><td><pre>Skew<span class="token punctuation">:</span>                          <span class="token operator">-</span><span class="token number">0.344</span>   Prob<span class="token punctuation">(</span>JB<span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token number">0.829</span></pre></td></tr><tr><td data-num="21"></td><td><pre>Kurtosis<span class="token punctuation">:</span>                       <span class="token number">1.847</span>   Cond<span class="token punctuation">.</span> No<span class="token punctuation">.</span>                         <span class="token number">77.8</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></pre></td></tr></table></figure><h1 id="stata篇"><a class="anchor" href="#stata篇">#</a> Stata 篇</h1>
<h2 id="简单使用stata"><a class="anchor" href="#简单使用stata">#</a> 简单使用 Stata</h2>
<ol>
<li>Log in</li>
<li>import data</li>
<li>save as</li>
<li>use data</li>
</ol>
<figure class="highlight stata"><figcaption data-lang="stata"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token command keyword">use</span> D<span class="token punctuation">:</span>\python\data_回归分析.dta</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token command keyword">regress</span> 売上高万円 広告費</pre></td></tr></table></figure><p>** 注意：** 使用的数据文件一定是.dta 格式，&lt;u&gt; 而这个必须要先导入数据后保存再得到。&lt;/u&gt;</p>
<p><strong>输出：</strong></p>
<pre><code class="language-Source">-------------+----------------------------------   F(1, 3)         =         .
       Model |        4000         1        4000   Prob &gt; F        =         .
    Residual |           0         3           0   R-squared       =    1.0000
-------------+----------------------------------   Adj R-squared   =    1.0000
       Total |        4000         4        1000   Root MSE        =         0

------------------------------------------------------------------------------
  売上高万円 | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      広告費 |          2          .        .       .            .           .
       _cons |         10          .        .       .            .           .
------------------------------------------------------------------------------
</code></pre>
<h3 id="附录"><a class="anchor" href="#附录">#</a> 附录</h3>
<table>
<thead>
<tr>
<th style="text-align:left">cost</th>
<th>sales</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">10</td>
<td>30</td>
</tr>
<tr>
<td style="text-align:left">20</td>
<td>50</td>
</tr>
<tr>
<td style="text-align:left">30</td>
<td>70</td>
</tr>
<tr>
<td style="text-align:left">40</td>
<td>90</td>
</tr>
<tr>
<td style="text-align:left">50</td>
<td>110</td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>经济统计</tag>
        <tag>Python</tag>
        <tag>Stata</tag>
      </tags>
  </entry>
  <entry>
    <title>Firefish | 菜鸟级别利用docker-compose搭建Fedi实例</title>
    <url>/2023/08/24/%E8%8F%9C%E9%B8%9F%E7%BA%A7%E5%88%AB%E5%88%A9%E7%94%A8docker-compose%E6%90%AD%E5%BB%BAFirefish%E5%AE%9E%E4%BE%8B/</url>
    <content><![CDATA[<p>2023 年，随着 X 社媒（原 Twitter）的全面塌陷，越来越多的网友逃向了 Fediverse 开源社交平台，其中著名的有 Mastodon、Misskey 和 Pleroma。前阵子，随着<span class="exturl" data-url="aHR0cHM6Ly9qb2luZmlyZWZpc2gub3Jn"> Firefish</span> 的 <s>横空问世</s> （Misskey 的一个 fork），博主便也想着搭一个玩玩。博主是计算机零基础的小白 <s>（超级白的那种）</s> ，靠着广大热心网友先后搭起了一个 Misskey 实例和一个 Pleroma 实例，这一次，也多亏了大家的帮忙，磕磕绊绊地终于搭好了 Firefish 实例。趁着记忆还鲜明，赶紧记录一下搭建过程。</p>
<p><span id="more"></span></p>
<h1 id="搭建过程"><a class="anchor" href="#搭建过程">#</a> 搭建过程</h1>
<p>因为是用<span class="exturl" data-url="aHR0cHM6Ly9naXQuam9pbmZpcmVmaXNoLm9yZy9maXJlZmlzaC9maXJlZmlzaC8tL2Jsb2IvZGV2ZWxvcC9kb2NzL2RvY2tlci5tZA=="> Docker-compose 搭建实例</span>，所以默认机器上是有 Docker 容器的。在此基础上，先在任意目录下新建 <code>docker-compose.yml</code>  文件。比如:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">mkdir</span> /firefish <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> /firefish</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">nano</span> docker-compose.yml</pre></td></tr></table></figure><p>然后<span class="exturl" data-url="aHR0cHM6Ly9naXQuam9pbmZpcmVmaXNoLm9yZy9maXJlZmlzaC9maXJlZmlzaC8tL2Jsb2IvZGV2ZWxvcC9kb2NrZXItY29tcG9zZS55bWw=">写入以下</span>：</p>
<figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">web</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.joinfirefish.org/firefish/firefish</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> firefish_web</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token punctuation">-</span> db</pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token punctuation">-</span> redis</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">### Uncomment one of the following to use a search engine</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">#     - meilisearch</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">#     - sonic</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"3000:3000"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token punctuation">-</span> calcnet</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">#     - web</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> production</pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token punctuation">-</span> ./files<span class="token punctuation">:</span>/firefish/files</pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token punctuation">-</span> ./.config<span class="token punctuation">:</span>/firefish/.config<span class="token punctuation">:</span>ro</pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token key atrule">redis</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.io/redis<span class="token punctuation">:</span>7.0<span class="token punctuation">-</span>alpine</pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> firefish_redis</pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token punctuation">-</span> calcnet</pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>      <span class="token punctuation">-</span> ./redis<span class="token punctuation">:</span>/data</pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token key atrule">db</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.io/postgres<span class="token punctuation">:</span>12.2<span class="token punctuation">-</span>alpine</pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> firefish_db</pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>      <span class="token punctuation">-</span> calcnet</pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token key atrule">env_file</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>      <span class="token punctuation">-</span> .config/docker.env</pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="42"></td><td><pre>      <span class="token punctuation">-</span> ./db<span class="token punctuation">:</span>/var/lib/postgresql/data</pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment">### Only one of the below should be used.</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token comment">### Meilisearch is better overall, but resource-intensive. Sonic is a very light full text search engine.</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token comment">#  meilisearch:</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token comment">#    container_name: meilisearch</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token comment">#    image: getmeili/meilisearch:v1.1.1</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token comment">#    environment:</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token comment">#      - MEILI_ENV=$&#123;MEILI_ENV:-development&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token comment">#    ports:</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token comment">#      - "7700:7700"</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token comment">#    networks:</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token comment">#      - calcnet</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token comment">#    volumes:</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token comment">#      - ./meili_data:/meili_data</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token comment">#    restart: unless-stopped</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token comment">#  sonic:</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token comment">#    restart: unless-stopped</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token comment">#    image: docker.io/valeriansaliou/sonic:v1.4.0</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token comment">#    networks:</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token comment">#      - calcnet</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token comment">#    volumes:</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token comment">#      - ./sonic:/var/lib/sonic/store</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token comment">#      - ./sonic/config.cfg:/etc/sonic.cfg</span></pre></td></tr><tr><td data-num="68"></td><td><pre></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="70"></td><td><pre>  <span class="token key atrule">calcnet</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="71"></td><td><pre>  <span class="token comment">#  web:</span></pre></td></tr><tr><td data-num="72"></td><td><pre>  <span class="token comment">#    external:</span></pre></td></tr><tr><td data-num="73"></td><td><pre>  <span class="token comment">#      name: web</span></pre></td></tr></table></figure><blockquote>
<p>注意：<br />
如果此前搭建过 Misskey 的话，那么端口号 3000 应当是冲突的，这时候需要把 <code>web</code>  下面的 <code>ports</code>  改成其他端口，比如 <code>4000:4000</code> 。</p>
</blockquote>
<p>写完 <code>docker-compose.yml</code>  文件之后，需要在 firefish 的根目录下新建 <code>.config</code>  文件夹，在里头装入<span class="exturl" data-url="aHR0cHM6Ly9naXQuam9pbmZpcmVmaXNoLm9yZy9maXJlZmlzaC9maXJlZmlzaC8tL2Jsb2IvZGV2ZWxvcC8uY29uZmlnL2V4YW1wbGUueW1s"> default.yml</span> 和<span class="exturl" data-url="aHR0cHM6Ly9naXQuam9pbmZpcmVmaXNoLm9yZy9maXJlZmlzaC9maXJlZmlzaC8tL2Jsb2IvZGV2ZWxvcC8uY29uZmlnL2RvY2tlcl9leGFtcGxlLmVudg=="> docker.env</span> 这两个文件。</p>
<p><strong>注意：</strong></p>
<ol>
<li>需要重命名：example.yml -&gt; default.yml &amp;&amp; docker_example.env -&gt; docker.env</li>
<li>修改 default.yml 的内容：url -&gt; 自己的域名 &amp;&amp; db localhost -&gt; firefish_db &amp;&amp; redis localhost -&gt; redis <s>（备注：localhost 一定要修改，博主就是在这里卡了好久 QAQ）</s></li>
<li>（可选）修改 default.yml 中的 port，如果端口有冲突的话。修改 db 的 user 和 pass，且两个文件一定要 match。</li>
</ol>
<p>待文件写入完毕之后，便可使容器上线： <code>docker-compose up -d</code></p>
<h1 id="反向代理nginx"><a class="anchor" href="#反向代理nginx">#</a> 反向代理：Nginx</h1>
<p>这一部分的话，大概有很多种操作方法，我只写了我使用的一种：利用 Certbot 获取证书然后用 Nginx 反向代理。</p>
<p>&lt;u&gt; 首先去 DNS 服务商添加一条指向服务器 IP 的 A 记录。&lt;/u &gt; 然后回到服务器，先切换 root 用户： <code>sudo -i</code> 。因为要使用 Certbot 和 Nginx，所以默认服务器上有这两个东西。</p>
<p>先<strong>获取证书</strong>，使用指令 <code>sudo certbot --nginx</code>  来获取证书，然后配置 Nginx。博主刚开始使用的是<span class="exturl" data-url="aHR0cHM6Ly9naXQuam9pbmZpcmVmaXNoLm9yZy9maXJlZmlzaC9maXJlZmlzaC8tL2Jsb2IvZGV2ZWxvcC9maXJlZmlzaC5uZ2lueC5jb25m"> firefish 的 Nginx 配置文件</span>，但是没有成功，后来经热心网友建议，使用<span class="exturl" data-url="aHR0cHM6Ly9taXNza2V5LWh1Yi5uZXQvZW4vZG9jcy9hZG1pbi9uZ2lueC5odG1s"> Misskey 的配置文件</span>试试，结果就成功了。</p>
<p>我的配置文件如下：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># For WebSocket</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>map <span class="token variable">$http_upgrade</span> <span class="token variable">$connection_upgrade</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    default upgrade<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token string">''</span>      close<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>  </pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>proxy_cache_path /tmp/nginx_cache_firefish <span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2 <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>cache2:16m <span class="token assign-left variable">max_size</span><span class="token operator">=</span>1g <span class="token assign-left variable">inactive</span><span class="token operator">=</span>720m <span class="token assign-left variable">use_temp_path</span><span class="token operator">=</span>off<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>  </pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>server <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    listen <span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>    server_name 你的域名<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>  </pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment"># For SSL domain validation</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>    root /var/www/html<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>    location /.well-known/acme-challenge/ <span class="token punctuation">&#123;</span> allow all<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    location /.well-known/pki-validation/ <span class="token punctuation">&#123;</span> allow all<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>    location / <span class="token punctuation">&#123;</span> <span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>  </pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>server <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>    listen <span class="token number">443</span> ssl http2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>    listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:443 ssl http2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre>    server_name 你的域名<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>  </pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre>    ssl_session_timeout 1d<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre>    ssl_session_cache shared:ssl_session_cache:10m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre></pre></td></tr><tr><td data-num="55"></td><td><pre>    ssl_session_tickets off<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre>  </pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token comment"># To use Let's Encrypt certificate</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>    ssl_certificate /etc/letsencrypt/live/你的域名/fullchain.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre>    ssl_certificate_key /etc/letsencrypt/live/你的域名/privkey.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre>  </pre></td></tr><tr><td data-num="66"></td><td><pre></pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token comment"># To use Debian/Ubuntu's self-signed certificate (For testing or before issuing a certificate)</span></pre></td></tr><tr><td data-num="68"></td><td><pre></pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token comment">#ssl_certificate     /etc/ssl/certs/ssl-cert-snakeoil.pem;</span></pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token comment">#ssl_certificate_key /etc/ssl/private/ssl-cert-snakeoil.key;</span></pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre>  </pre></td></tr><tr><td data-num="74"></td><td><pre></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token comment"># SSL protocol settings</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre>    ssl_protocols TLSv1.2 TLSv1.3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre></pre></td></tr><tr><td data-num="79"></td><td><pre>    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="80"></td><td><pre></pre></td></tr><tr><td data-num="81"></td><td><pre>    ssl_prefer_server_ciphers off<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre>    ssl_stapling on<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre></pre></td></tr><tr><td data-num="85"></td><td><pre>    ssl_stapling_verify on<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre></pre></td></tr><tr><td data-num="87"></td><td><pre>  </pre></td></tr><tr><td data-num="88"></td><td><pre></pre></td></tr><tr><td data-num="89"></td><td><pre>    <span class="token comment"># Change to your upload limit</span></pre></td></tr><tr><td data-num="90"></td><td><pre></pre></td></tr><tr><td data-num="91"></td><td><pre>    client_max_body_size 80m<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre></pre></td></tr><tr><td data-num="93"></td><td><pre>  </pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre>    <span class="token comment"># Proxy to Node</span></pre></td></tr><tr><td data-num="96"></td><td><pre></pre></td></tr><tr><td data-num="97"></td><td><pre>    location / <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="98"></td><td><pre></pre></td></tr><tr><td data-num="99"></td><td><pre>        proxy_pass http://127.0.0.1:6110<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="100"></td><td><pre></pre></td></tr><tr><td data-num="101"></td><td><pre>        proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre></pre></td></tr><tr><td data-num="103"></td><td><pre>        proxy_http_version <span class="token number">1.1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre></pre></td></tr><tr><td data-num="105"></td><td><pre>        proxy_redirect off<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre></pre></td></tr><tr><td data-num="107"></td><td><pre>  </pre></td></tr><tr><td data-num="108"></td><td><pre>  </pre></td></tr><tr><td data-num="109"></td><td><pre></pre></td></tr><tr><td data-num="110"></td><td><pre>        <span class="token comment"># For WebSocket</span></pre></td></tr><tr><td data-num="111"></td><td><pre></pre></td></tr><tr><td data-num="112"></td><td><pre>        proxy_set_header Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="113"></td><td><pre></pre></td></tr><tr><td data-num="114"></td><td><pre>        proxy_set_header Connection <span class="token variable">$connection_upgrade</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre></pre></td></tr><tr><td data-num="116"></td><td><pre>  </pre></td></tr><tr><td data-num="117"></td><td><pre></pre></td></tr><tr><td data-num="118"></td><td><pre>        <span class="token comment"># Cache settings</span></pre></td></tr><tr><td data-num="119"></td><td><pre></pre></td></tr><tr><td data-num="120"></td><td><pre>        proxy_cache cache2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="121"></td><td><pre></pre></td></tr><tr><td data-num="122"></td><td><pre>        proxy_cache_lock on<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre></pre></td></tr><tr><td data-num="124"></td><td><pre>        proxy_cache_use_stale updating<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="125"></td><td><pre></pre></td></tr><tr><td data-num="126"></td><td><pre>        proxy_force_ranges on<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="127"></td><td><pre></pre></td></tr><tr><td data-num="128"></td><td><pre>        add_header X-Cache <span class="token variable">$upstream_cache_status</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="129"></td><td><pre></pre></td></tr><tr><td data-num="130"></td><td><pre>  </pre></td></tr><tr><td data-num="131"></td><td><pre></pre></td></tr><tr><td data-num="132"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="133"></td><td><pre></pre></td></tr><tr><td data-num="134"></td><td><pre><span class="token comment">#1location =/robots.txt &#123;</span></pre></td></tr><tr><td data-num="135"></td><td><pre></pre></td></tr><tr><td data-num="136"></td><td><pre><span class="token comment">#2    default_type text/html;</span></pre></td></tr><tr><td data-num="137"></td><td><pre></pre></td></tr><tr><td data-num="138"></td><td><pre><span class="token comment">#3    add_header Content-Type "text/plain; charset=UTF-8";</span></pre></td></tr><tr><td data-num="139"></td><td><pre></pre></td></tr><tr><td data-num="140"></td><td><pre><span class="token comment">#4    return 200 "User-agent: *\nDisallow: /\n";</span></pre></td></tr><tr><td data-num="141"></td><td><pre></pre></td></tr><tr><td data-num="142"></td><td><pre><span class="token comment">#5&#125;</span></pre></td></tr><tr><td data-num="143"></td><td><pre></pre></td></tr><tr><td data-num="144"></td><td><pre>  </pre></td></tr><tr><td data-num="145"></td><td><pre></pre></td></tr><tr><td data-num="146"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>注意：</strong></p>
<ol>
<li>我修改了缓存地址，否则会和原来 Misskey 的缓存地址冲突：proxy_cache_path /tmp/nginx_cache_firefish</li>
<li>将 cache1 改为了 cache2，共 2 处。</li>
<li>端口号要和 docker-compose.yml 和 default.yml 的一致。</li>
<li>需要修改 <code>你的域名</code> ，共 4 处。</li>
</ol>
<p>获取完证书和配置好 Nginx 文件之后，试着测试一下： <code>nginx -t</code> , 没有问题的话便是重载和重启 Nginx：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>nginx <span class="token parameter variable">-s</span> reload</pre></td></tr><tr><td data-num="2"></td><td><pre>systemctl restart nginx</pre></td></tr></table></figure><p>（如果是第一次使用 Nginx 的话，不是 restart 而是 start）</p>
<h1 id="痛苦的排错之路"><a class="anchor" href="#痛苦的排错之路">#</a> 痛苦的排错之路</h1>
<p>作为一个小白搭建实例免不了一路红灯 <s>（说的就是 error 呜呜）</s> ，总结了一下，出错原因要么是容器里的服务没有跑起来要么就是 Nginx 搞错了。</p>
<ul>
<li>Docker 容器</li>
</ul>
<ol>
<li>首先 restart 一下容器： <code>docker-compose restart</code> ，这是解决 <code>502 error</code>  最好的办法 <s>（大佬说的）</s> 。</li>
<li>然后看看 <code>docker ps</code>  里面的服务是不是都 up 了。没有的话可能就是配置错了，回去改改配置，最后 <code>docker-compose up -d</code>  来更新容器。</li>
<li>实在不行，就通过 <code>docker compose logs web -f --tail 100</code>  来查看日志。</li>
</ol>
<ul>
<li>Nginx 反代</li>
</ul>
<ol>
<li>如果是 <code>502 error</code>  的话，如上所说先试试 <code>docker-compose restart</code> 。</li>
<li>如果不行或是其他错误，先用 <code>nginx -t</code>  看看是否成功，没有成功的话可能就是配置文件写错了，注意<strong>端口号</strong>等等。</li>
<li>test 没有问题的话，再看看 nginx 的 status： <code>sudo systemctl status nginx</code> 。</li>
<li>清理缓存，再用 <code>service nginx reload</code>  重载，然后 <code>systemctl restart nginx</code>  重启。</li>
</ol>
<ul>
<li>其他<br />
可以用 <code>curl -v http://localhost:端口号</code> 看能不能拉取到信息。</li>
</ul>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Fediverse</tag>
        <tag>Firefish</tag>
        <tag>Dokcer</tag>
      </tags>
  </entry>
  <entry>
    <title>零基础小白的博客搭建全记录（GitHub+Hexo）</title>
    <url>/2023/03/23/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E5%85%A8%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>2023 年 3 月 23 日，小倖第一次成功<a href="https://nanakumo.github.io/">通过 GitHub 搭好了 Hexo 的博客</a>。兴奋之余，也想要将这场历时两天的艰辛记录下来。如您所见，小倖是小白，故这篇<strong>不是技术帖！！！</strong><s>（其实更像是小倖的碎碎念啦）</s></p>
<p><span id="more"></span></p>
<p>小倖真是踩了好多坑。因为 Vercel（一个开箱即用的网站托管平台）已经没有了 Hexo 的框架，因此没有办法懒人建站法 —— 一键通过 Vercel 建站了。小倖在网上也找了很多博客搭建方法，尝试过的有：</p>
<ul>
<li>Cloudflare Pages</li>
<li>Github Pages</li>
<li>Wordpress</li>
<li>Vercel</li>
</ul>
<p>前两个是一直卡在网站发布上（即在本地查看没有问题，但无法在网页中显示）。Wordpress 是因为太笨重了遂放弃。小倖倒是通过 Vercel 建好了一个<span class="exturl" data-url="aHR0cHM6Ly9odWdvLW5hbmFrdW1vLnZlcmNlbC5hcHAv"> Hugo 的博客</span>，但如前言所说，Vercel 现在已经没有 Hexo 的框架了，因而在搭建 Hexo 博客上一直失败。</p>
<p>** 补充：** 在网络上，通过 GitHub Pages 部署 Hexo 站点的办法大致分成两种。一种是将本地代码 Push 到远程仓后，在相应 Repo 的 Settings 中找到 Pages，部署是在那里完成的；另一种是通过 <code>hexo d</code>  命令来部署。前者小倖一直失败，后者倒是几乎毫无障碍地建成了，遂推荐。</p>
<p><s>（为什么小倖一定要一个 Hexo 的博客呢？还不是因为 Hexo Themes 有很多很好看的主题嘛。）</s></p>
<p>总之，小倖现在终于能够拥有一个可爱的博客啦，很开心☆*: .｡. o (≧▽≦) o .｡.:*☆☆*: .｡</p>
<h2 id="博客搭建"><a class="anchor" href="#博客搭建">#</a> 博客搭建</h2>
<h3 id="1-初识hexo"><a class="anchor" href="#1-初识hexo">#</a> 1. 初识 Hexo</h3>
<p><span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvLw==">Hexo</span> 是友邻推荐给小倖的，小倖也经常在各个地方看到，当然最主要是主题很好看啦，遂采用。Hexo 对于小倖来说有如下几个优点：</p>
<ul>
<li>发布方便
<ul>
<li>只需要在 Git Bash 中敲几行代码即可部署到 Github Pages 等平台上。</li>
</ul>
</li>
<li>支持 Markdown
<ul>
<li>虽然几乎现在所有的平台都支持啦。</li>
</ul>
</li>
<li>海量主题任君挑选
<ul>
<li>这才是最重要的嘛！</li>
</ul>
</li>
</ul>
<p>总之，Hexo 最高！</p>
<h3 id="2-准备工作环境布置"><a class="anchor" href="#2-准备工作环境布置">#</a> 2. 准备工作：环境布置</h3>
<p>想要将通过 Hexo 布置站点，首先需要布置 <code>Node.js</code>  和 <code>Git</code>  环境。</p>
<p>这一步不难，只要进入各自的官网中下载就可以了。</p>
<p>Node.js 下载：<span class="exturl" data-url="aHR0cHM6Ly9ub2RlanMub3JnL2VuL2Rvd25sb2Fk">https://nodejs.org/en/download</span><br />
Git 下载：<span class="exturl" data-url="aHR0cHM6Ly9naXQtc2NtLmNvbS9kb3dubG9hZHM=">https://git-scm.com/downloads</span></p>
<p>如何检验自己是否成功安装呢？可在 Git Bash 中输入如下命令：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">git</span> version</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">node</span> <span class="token parameter variable">-v</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">npm</span> <span class="token parameter variable">-v</span></pre></td></tr></table></figure><p>如果能够出现对应的版本号，则说明安装完成。接下来就可以进入 Hexo 的安装阶段啦。</p>
<h3 id="3-安装hexo"><a class="anchor" href="#3-安装hexo">#</a> 3. 安装 Hexo</h3>
<p>这一步也很简单，只需要敲入如下命令：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> hexo-cli        <span class="token comment">#安装 Hexo</span></pre></td></tr><tr><td data-num="2"></td><td><pre>hexo init <span class="token operator">&lt;</span>文件夹名<span class="token operator">></span>            <span class="token comment">#创建文件夹并初始化</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">cd</span>  <span class="token operator">&lt;</span>文件夹名<span class="token operator">></span>                  <span class="token comment">#进入该文件夹</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span>                    <span class="token comment">#导入文件</span></pre></td></tr></table></figure><p>这样就会得到包含配置文件 <code>_config.yml</code>  的文件夹啦。你可以在该文件里个性化自己的网站。</p>
<p>其实这样就算建好了一个很简陋的站，如何查看自己的站到底长什么样子呢？可通过运行以下命令：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#注意：都要在根目录下进行</span></pre></td></tr><tr><td data-num="2"></td><td><pre>hexo cl                        <span class="token comment">#清理缓存</span></pre></td></tr><tr><td data-num="3"></td><td><pre>hexo g                         <span class="token comment">#产生静态档案</span></pre></td></tr><tr><td data-num="4"></td><td><pre>hexo s                         <span class="token comment">#启动服务器</span></pre></td></tr></table></figure><p>运行完之后，就可以通过 <code>http://localhost:4000</code>  来查看自己的站点啦。不过这时候只是在本地查看，还没有布置在网络上哦。因此接下来就是 ——</p>
<h3 id="4-将hexo博客部署到github-pages上"><a class="anchor" href="#4-将hexo博客部署到github-pages上">#</a> 4. 将 Hexo 博客部署到 Github Pages 上</h3>
<p>在这一步中，你首先需要拥有一个 GitHub 账号，然后建一个 repo。这一步十分简单，就不多赘述了。建好 repo 之后，建议设置一个 <code>SSH密钥</code> ，以便通过 SSH<strong> 连接</strong> GitHub，而不必总是输入你的用户名和密码。</p>
<p>那么，接下来就试着运行以下代码吧：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#首先，让你的笔记本电脑知道你将使用哪个 GitHub 账户</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">git</span> config <span class="token parameter variable">--global</span> user.name <span class="token string">"GitHub账户名"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">git</span> config <span class="token parameter variable">--global</span> user.email <span class="token string">"GitHub注册邮箱"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#产生一个 SSH 密钥对</span></pre></td></tr><tr><td data-num="5"></td><td><pre>ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-C</span> <span class="token string">"GitHub注册邮箱"</span></pre></td></tr></table></figure><p>运行过程中，电脑会问你要将 SSH 密钥保存在哪个文件夹里，紧接着，你就可以在那个文件夹里看到 <code>id_rsa.pub</code>  这个文件啦。打开它，将内容复制到你的 GitHub 中。</p>
<blockquote>
<p>具体方法：在 GitHub 的 <code>settings</code>  中找到 <code>SSH and GPG keys</code> ，打开它，然后新建一个 SSH Key，将剪切板的内容粘贴进去，就大功告成啦！</p>
</blockquote>
<p>在让你的笔记本知道你将使用哪个 GitHub 账户之后，还需要让你的 Hexo 站点知道你使用的是哪一个 repo 。操作方法就是打开网站的配置文件  <code>_config.yml</code>  ，找到  <code>deploy</code>  行（一般是在最末），将其修改成以下内容：</p>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>deploy:</pre></td></tr><tr><td data-num="2"></td><td><pre>  type: git</pre></td></tr><tr><td data-num="3"></td><td><pre>  repo: 你的仓库链接，通常的格式为 https:&#x2F;&#x2F;github.com&#x2F; 账户名 &#x2F; 仓库名.github.io.git</pre></td></tr><tr><td data-num="4"></td><td><pre>  branch: master</pre></td></tr><tr><td data-num="5"></td><td><pre>  message: &quot;&#123;&#123; now \(&#39;YYYY-MM-DD HH:mm:ss&#39; \) &#125; &#125;&quot;</pre></td></tr></table></figure><blockquote>
<p>不过，如果要使用 GitHub Pages，仓库名必须与账户名一致，详情见<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vZW4vcGFnZXMvZ2V0dGluZy1zdGFydGVkLXdpdGgtZ2l0aHViLXBhZ2VzL2NyZWF0aW5nLWEtZ2l0aHViLXBhZ2VzLXNpdGU=">官方文档</span>。</p>
</blockquote>
<p>接下来，就是通过 <code>hexo d</code>  命令来将 Hexo 站点部署到 GitHub Pages 上啦，不过在此之前，需要下载一个 <code>deploy tool</code> 。请在你的 Git Bash 输入 <code>npm install hexo-deployer-git --save</code> 。安装完之后，再键入 <code>hexo d</code> 。恭喜你，你的站点能被大家访问了。</p>
<h3 id="5-博客装修"><a class="anchor" href="#5-博客装修">#</a> 5. 博客装修</h3>
<h4 id="51-安装主题文件"><a class="anchor" href="#51-安装主题文件">#</a> 5.1 安装主题文件</h4>
<p>如前文所说，目前这个站点还很简陋，因此就到了最<s>激动人心</s>的时刻 —— 网站装修！请尽情在<span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL3RoZW1lcy8="> Hexo Themes</span> 中寻找一款自己心水的主题吧。</p>
<p>具体的安装方法请详见各自主题文件夹中的 <code>README.md</code>  文件，一般步骤为：先将主题文件夹克隆至本地仓，然后修改网站配置文件 <code>_config.yml</code>  中的 <code>theme</code>  行: <code>theme: your_theme</code> 。</p>
<h4 id="52-修改具体配置"><a class="anchor" href="#52-修改具体配置">#</a> 5.2 修改具体配置</h4>
<p>如果你想个性化你的网站，请在主题文件中的 <code>_config.yml</code>  里修改吧。比如为你的网站增添 <code>social link</code> ，还可以为你的网站添加头像和背景图。</p>
<h4 id="53-增加标签-目录等页面"><a class="anchor" href="#53-增加标签-目录等页面">#</a> 5.3 增加标签、目录等页面</h4>
<p>如果你希望你的文章能够自动归档在对应的页面之下，大多数情况下是需要进行一些设置的。</p>
<p>一般而言，你的主题配置文件中应当是包含以下行的：</p>
<figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">menu</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token key atrule">Home</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token key atrule">name</span><span class="token punctuation">:</span> house</pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token key atrule">theme</span><span class="token punctuation">:</span> solid</pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token key atrule">link</span><span class="token punctuation">:</span> /</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">About</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token key atrule">name</span><span class="token punctuation">:</span> id<span class="token punctuation">-</span>card</pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token key atrule">theme</span><span class="token punctuation">:</span> solid</pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token key atrule">link</span><span class="token punctuation">:</span> /about</pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">Archives</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token key atrule">name</span><span class="token punctuation">:</span> box<span class="token punctuation">-</span>archive</pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token key atrule">theme</span><span class="token punctuation">:</span> solid</pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token key atrule">link</span><span class="token punctuation">:</span> /archives</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token key atrule">Categories</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token key atrule">name</span><span class="token punctuation">:</span> bookmark</pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token key atrule">theme</span><span class="token punctuation">:</span> solid</pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token key atrule">link</span><span class="token punctuation">:</span> /categories</pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token key atrule">Tags</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token key atrule">name</span><span class="token punctuation">:</span> tags</pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token key atrule">theme</span><span class="token punctuation">:</span> solid</pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token key atrule">link</span><span class="token punctuation">:</span> /tags</pre></td></tr></table></figure><p>如果有的话，那就没有关系，没有的话，还需要自己添加。</p>
<p>接下来，就是替你的网站创建对应的页面，具体操作是在 Git Bash 中敲下：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>hexo new page tags</pre></td></tr><tr><td data-num="2"></td><td><pre>hexo new page categories</pre></td></tr><tr><td data-num="3"></td><td><pre>hexo new page about</pre></td></tr></table></figure><p>接下来，你就会惊奇地发现，在 <code>source</code>  文件夹之下，不仅有了对应的文件夹，里面还各自都有 <code>index.md</code>  文件！请挨个打开它，然后在文件的最后一行填上 <code>type: ''</code> 。例如，在 tags 的 <code>index.md</code>  中应当填入以下内容：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>---</pre></td></tr><tr><td data-num="2"></td><td><pre>title: tags</pre></td></tr><tr><td data-num="3"></td><td><pre>date: <span class="token number">2023</span>-03-23 <span class="token number">18</span>:50:30</pre></td></tr><tr><td data-num="4"></td><td><pre>type: <span class="token string">'tags'</span></pre></td></tr><tr><td data-num="5"></td><td><pre>---</pre></td></tr></table></figure><p>设置好之后，只需要在你的文章中使用<span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZnJvbnQtbWF0dGVy"> Front-matter</span> 就好啦。例如：</p>
<pre><code>---
title: 零基础小白的博客搭建全记录（GitHub+Hexo）
categories: 今天敲点什么代码呢
tags: [博客,hexo,github]
---
</code></pre>
<h4 id="54-使用-more-让博客页面更简洁"><a class="anchor" href="#54-使用-more-让博客页面更简洁">#</a> 5.4 使用！-- more -- 让博客页面更简洁</h4>
<p>由于很多主题的网页浏览都是直接全文显示的，这种时候会让你的网站显得笨重。那么 <code>!-- more --</code>  就会将其变得简洁！可以参照这篇博文：<span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC83OGMyMThmOWQxZTc=">https://www.jianshu.com/p/78c218f9d1e7</span></p>
<h4 id="55-为你的博客开启评论功能吧"><a class="anchor" href="#55-为你的博客开启评论功能吧">#</a> 5.5 为你的博客开启评论功能吧</h4>
<p>目前的评论的系统有很多，大概有：</p>
<ul>
<li>Gitalk</li>
<li>Giscus</li>
<li>Waline</li>
<li>Twikoo</li>
</ul>
<p>小倖使用的是<span class="exturl" data-url="aHR0cHM6Ly9naXNjdXMuYXBwLw=="> Giscus</span>。可以直接在官方文档上面设置，不过有一些前提条件和准备工作：</p>
<ol>
<li>repo 必须是公开的。</li>
<li>安装<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FwcHMvZ2lzY3Vz"> giscus app</span>。</li>
<li>为你的 repo<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vZW4vcmVwb3NpdG9yaWVzL21hbmFnaW5nLXlvdXItcmVwb3NpdG9yeXMtc2V0dGluZ3MtYW5kLWZlYXR1cmVzL2VuYWJsaW5nLWZlYXR1cmVzLWZvci15b3VyLXJlcG9zaXRvcnkvZW5hYmxpbmctb3ItZGlzYWJsaW5nLWdpdGh1Yi1kaXNjdXNzaW9ucy1mb3ItYS1yZXBvc2l0b3J5"> 启用 Discussions 功能</span>。</li>
</ol>
<p>一步一步跟着<span class="exturl" data-url="aHR0cHM6Ly9naXNjdXMuYXBwLw==">官方文档</span>来，最后就会到达 <code>启用giscus</code>  这一步。你将会得到如下字段：</p>
<figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre>src="https<span class="token punctuation">:</span>//giscus.app/client.js"</pre></td></tr><tr><td data-num="2"></td><td><pre>        data<span class="token punctuation">-</span>repo="<span class="token punctuation">[</span>ENTER REPO HERE<span class="token punctuation">]</span>"</pre></td></tr><tr><td data-num="3"></td><td><pre>        data<span class="token punctuation">-</span>repo<span class="token punctuation">-</span>id="<span class="token punctuation">[</span>ENTER REPO ID HERE<span class="token punctuation">]</span>"</pre></td></tr><tr><td data-num="4"></td><td><pre>        data<span class="token punctuation">-</span>category="<span class="token punctuation">[</span>ENTER CATEGORY NAME HERE<span class="token punctuation">]</span>"</pre></td></tr><tr><td data-num="5"></td><td><pre>        data<span class="token punctuation">-</span>category<span class="token punctuation">-</span>id="<span class="token punctuation">[</span>ENTER CATEGORY ID HERE<span class="token punctuation">]</span>"</pre></td></tr><tr><td data-num="6"></td><td><pre>        data<span class="token punctuation">-</span>mapping="pathname"</pre></td></tr><tr><td data-num="7"></td><td><pre>        data<span class="token punctuation">-</span>strict="0"</pre></td></tr><tr><td data-num="8"></td><td><pre>        data<span class="token punctuation">-</span>reactions<span class="token punctuation">-</span>enabled="1"</pre></td></tr><tr><td data-num="9"></td><td><pre>        data<span class="token punctuation">-</span>emit<span class="token punctuation">-</span>metadata="0"</pre></td></tr><tr><td data-num="10"></td><td><pre>        data<span class="token punctuation">-</span>input<span class="token punctuation">-</span>position="bottom"</pre></td></tr><tr><td data-num="11"></td><td><pre>        data<span class="token punctuation">-</span>theme="light"</pre></td></tr><tr><td data-num="12"></td><td><pre>        data<span class="token punctuation">-</span>lang="en"</pre></td></tr><tr><td data-num="13"></td><td><pre>        crossorigin="anonymous"</pre></td></tr><tr><td data-num="14"></td><td><pre>        async<span class="token punctuation">></span></pre></td></tr></table></figure><p>然后将其写入你的主题配置文件 <code>_config.yml</code>  中即可！小倖是这样写的：</p>
<figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">giscus</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">src</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//giscus.app/client.js</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">repo</span><span class="token punctuation">:</span> nanakumo/nanakumo.github.io</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">repoID</span><span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">category</span><span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">categoryID</span><span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">mapping</span><span class="token punctuation">:</span> pathname</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token key atrule">strict</span><span class="token punctuation">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">reactionsEnabled</span><span class="token punctuation">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">emitMetadata</span><span class="token punctuation">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">inputPosition</span><span class="token punctuation">:</span> bottom</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token key atrule">theme</span><span class="token punctuation">:</span> cobalt</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token key atrule">lang</span><span class="token punctuation">:</span> zh<span class="token punctuation">-</span>CN</pre></td></tr></table></figure><h2 id="写在最后的话"><a class="anchor" href="#写在最后的话">#</a> 写在最后的话</h2>
<blockquote>
<p>至此，你就可以享受你的博客之旅啦。请记住，每次在本地修改完之后，请一定要 <code>hexo g &amp;&amp; hexo d</code>  噢！</p>
</blockquote>
]]></content>
      <categories>
        <category>一些有的没的</category>
      </categories>
      <tags>
        <tag>博客</tag>
        <tag>hexo</tag>
        <tag>github</tag>
      </tags>
  </entry>
</search>
